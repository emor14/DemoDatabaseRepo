CREATE FUNCTION [dbo].[SplitToVarCharWithIndex] ( @list NVARCHAR(MAX) ) RETURNS @ParsedList TABLE ( [Index] INT, Individual VARCHAR(255) ) AS BEGIN DECLARE @Individual NVARCHAR(255), @Pos1 INT, @Pos2 INT, @Index INT SET @list = ',' + @list + ',' SET @Pos1 = CHARINDEX(',', @list) SET @Pos2 = CHARINDEX(',', @list, @Pos1+1) SET @Index = 0 WHILE (@Pos2 > @Pos1) BEGIN SET @Individual = SUBSTRING(@list, @Pos1+1, @Pos2-@Pos1-1) INSERT INTO @ParsedList ([Index], Individual) VALUES (@Index, CAST(@Individual AS VARCHAR(255))) SET @Pos1 = @Pos2 SET @Pos2 = CHARINDEX(',', @list, @Pos1+1) SET @Index = @Index + 1 END RETURN END
